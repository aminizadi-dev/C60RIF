# اسکریپت تبدیل "مشتری" به "کاربر" و "مشتریان" به "کاربران"

این اسکریپت تمام رشته‌های localization فارسی را که شامل کلمات "مشتری" یا "مشتریان" هستند، به "کاربر" و "کاربران" تبدیل می‌کند.

## ⚠️ هشدار مهم

**قبل از اجرای اسکریپت:**
1. از دیتابیس خود Backup بگیرید
2. ابتدا بخش Preview (STEP 3) را اجرا کنید تا ببینید چه تغییراتی اعمال می‌شود
3. تغییرات را بررسی کنید
4. سپس اسکریپت اصلی را اجرا کنید

## فایل‌های موجود

سه نسخه از اسکریپت موجود است:

1. **`ReplaceCustomerToUser_Persian.sql`** - نسخه ساده (بدون Transaction)
2. **`ReplaceCustomerToUser_Persian_Safe.sql`** - نسخه امن با Transaction (توصیه می‌شود)
3. **`Rollback_CustomerToUser_Persian.sql`** - اسکریپت بازگشت تغییرات

## روش استفاده

### مرحله 1: پیدا کردن شناسه زبان فارسی

```sql
SELECT Id, Name, LanguageCulture FROM [Language] 
WHERE LanguageCulture LIKE '%fa%' 
   OR Name LIKE '%Persian%' 
   OR Name LIKE '%Farsi%';
```

### مرحله 2: تنظیم متغیر @LanguageId

در فایل SQL مورد نظر، مقدار `@LanguageId` را با شناسه زبان فارسی خود جایگزین کنید:

```sql
DECLARE @LanguageId INT = 2; -- شناسه زبان فارسی خود را اینجا قرار دهید
```

### مرحله 3: پیش‌نمایش تغییرات (اختیاری اما توصیه می‌شود)

قبل از اعمال تغییرات، می‌توانید ببینید چه تغییراتی اعمال می‌شود:

```sql
-- بخش STEP 3 را uncomment کنید و اجرا کنید
```

### مرحله 4: اجرای اسکریپت

**توصیه: از نسخه Safe استفاده کنید** (`ReplaceCustomerToUser_Persian_Safe.sql`)

این نسخه از Transaction استفاده می‌کند و در صورت بروز خطا، تغییرات را Rollback می‌کند.

### مرحله 5: بررسی تغییرات

پس از اجرا، بخش STEP 5 را uncomment کنید تا تغییرات را بررسی کنید.

## نحوه کار اسکریپت

اسکریپت به ترتیب زیر عمل می‌کند:

1. **ابتدا "مشتریان" را جایگزین می‌کند** با "کاربران"
   - این کار اول انجام می‌شود تا از جایگزینی جزئی جلوگیری شود
   - اگر ابتدا "مشتری" را جایگزین کنیم، "مشتریان" به "کاربران" تبدیل می‌شود که اشتباه است

2. **سپس "مشتری" را جایگزین می‌کند** با "کاربر"
   - پس از جایگزینی "مشتریان"، حالا می‌توانیم با خیال راحت "مشتری" را جایگزین کنیم

## مثال‌های تبدیل

- "مشتری جدید" → "کاربر جدید"
- "مشتریان" → "کاربران"
- "فهرست مشتریان" → "فهرست کاربران"
- "اطلاعات مشتری" → "اطلاعات کاربر"
- "مدیریت مشتریان" → "مدیریت کاربران"

## نکات مهم

1. **Backup**: همیشه قبل از اجرای UPDATE queries از دیتابیس Backup بگیرید
2. **Preview**: حتماً ابتدا بخش Preview را اجرا کنید
3. **Cache**: پس از اجرا، Cache را پاک کنید تا تغییرات اعمال شوند
4. **تست**: در محیط Development تست کنید قبل از اجرا در Production

## پاک کردن Cache

پس از اجرای اسکریپت:

1. از طریق Admin Panel:
   - Configuration > Maintenance > Clear Cache

2. یا از طریق فایل سیستم:
   - حذف فایل‌های Cache در پوشه `App_Data`

## بازگشت تغییرات (Rollback)

اگر نیاز به بازگشت تغییرات دارید، از فایل `Rollback_CustomerToUser_Persian.sql` استفاده کنید:

1. شناسه زبان فارسی را تنظیم کنید
2. اسکریپت را اجرا کنید
3. این اسکریپت "کاربران" را به "مشتریان" و "کاربر" را به "مشتری" تبدیل می‌کند

**نکته:** اسکریپت Rollback هم از Transaction استفاده می‌کند و در صورت خطا، تغییرات را بازمی‌گرداند.

## محدودیت‌ها

- این اسکریپت فقط در `ResourceValue` جستجو و جایگزینی انجام می‌دهد
- فقط برای زبان فارسی (LanguageId مشخص شده) اعمال می‌شود
- اگر کلمات "مشتری" یا "مشتریان" در ResourceName باشند، تغییر نمی‌کنند (فقط ResourceValue)

